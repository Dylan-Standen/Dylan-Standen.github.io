# Create a fully working single-file HTML website with blackboard style, Markdown+KaTeX support,
# and sections for Experiments, Blog, Essays, and About. Includes export/import and image insertion.
html = r"""<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Neuro Notes — Blackboard</title>

  <!-- KaTeX (for LaTeX math rendering) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js"></script>

  <!-- Markdown + Sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

  <style>
    :root {
      --bg: #0a0a0a;
      --bg2: #101010;
      --fg: #f1f1f1;
      --muted: #c9c9c9;
      --line: #2a2a2a;
      --accent: #ffffff;
      --card: #0e0e0e;
      --chip: #141414;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--sans);
      line-height: 1.6;
    }
    /* Blackboard texture hint (subtle noise) */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(ellipse at top left, rgba(255,255,255,0.035), transparent 45%),
        radial-gradient(ellipse at bottom right, rgba(255,255,255,0.025), transparent 45%);
      mix-blend-mode: screen;
      opacity: .7;
    }

    a { color: var(--fg); }
    a:hover { text-decoration: underline; }

    .container { max-width: 1100px; margin: 0 auto; padding: 0 16px; }

    header {
      position: sticky; top: 0; z-index: 10;
      background: linear-gradient(to bottom, rgba(0,0,0,.95), rgba(0,0,0,.85));
      border-bottom: 1px dashed var(--line);
      backdrop-filter: blur(4px);
    }
    .nav {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 0;
    }
    .logo {
      display: inline-flex; align-items: center; gap: 10px;
      text-decoration: none;
    }
    .logo svg { display: block; }
    .logo-title { font-weight: 700; letter-spacing: .3px; }
    .logo-sub { font-size: 12px; color: var(--muted); line-height: 1; margin-top: -4px; }

    .nav-links { margin-left: auto; display: flex; gap: 6px; }
    .tab {
      padding: 8px 12px; border: 1px dashed var(--line); border-radius: 10px;
      background: var(--chip); color: var(--fg); text-decoration: none; font-size: 14px;
    }
    .tab.active, .tab:hover { outline: 2px solid #fff; outline-offset: -2px; }

    .toolbar {
      display: flex; gap: 8px; align-items: center; flex-wrap: wrap;
    }
    .btn {
      background: var(--chip);
      color: var(--fg);
      border: 1px dashed var(--line);
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover { outline: 2px solid #fff; outline-offset: -2px; }

    .input, .select, .textarea {
      width: 100%;
      background: var(--bg2);
      color: var(--fg);
      border: 1px dashed var(--line);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
    }
    .textarea { min-height: 180px; font-family: var(--mono); white-space: pre-wrap; }
    .field { margin-bottom: 12px; }
    .label { display: block; color: var(--muted); font-size: 12px; margin-bottom: 6px; }

    .card {
      background: var(--card);
      border: 1px dashed var(--line);
      border-radius: 14px;
      padding: 16px;
    }

    .list { display: grid; gap: 10px; }
    .item { padding: 14px; border-radius: 12px; border: 1px dashed var(--line); background: #0d0d0d; }
    .item-head { display: flex; align-items: baseline; gap: 8px; justify-content: space-between; }
    .item-title { font-weight: 600; font-size: 18px; }
    .item-meta { color: var(--muted); font-size: 12px; }
    .item-actions { display: flex; gap: 6px; }

    .prose { font-size: 16px; }
    .prose h1, .prose h2, .prose h3 { margin: 18px 0 8px; }
    .prose img { max-width: 100%; border: 1px dashed var(--line); border-radius: 10px; padding: 4px; background: #090909; }
    .prose code { background: #111; padding: 2px 6px; border-radius: 6px; border: 1px dashed var(--line); }
    .prose pre { background: #111; padding: 12px; border-radius: 10px; border: 1px dashed var(--line); overflow: auto; }
    .hint { color: var(--muted); font-size: 13px; }

    footer { border-top: 1px dashed var(--line); margin-top: 40px; color: var(--muted); }
    footer .inner { padding: 16px 0; display: flex; justify-content: space-between; align-items: center; }

    /* Hide all sections by default; show via [data-page] attribute */
    main > section { display: none; padding: 18px 0 24px; }
    main > section.active { display: block; }

    /* Small screens */
    @media (max-width: 640px) {
      .nav-links { width: 100%; margin: 8px 0 0; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a href="#experiments" class="logo">
        <!-- Physics-y logo: an "atom" drawn like chalk -->
        <svg width="42" height="42" viewBox="0 0 64 64" fill="none" stroke="white" stroke-width="2">
          <circle cx="32" cy="32" r="3" fill="white"></circle>
          <ellipse cx="32" cy="32" rx="22" ry="10" transform="rotate(20 32 32)" />
          <ellipse cx="32" cy="32" rx="22" ry="10" transform="rotate(-20 32 32)" />
          <ellipse cx="32" cy="32" rx="22" ry="10" transform="rotate(90 32 32)" />
        </svg>
        <div>
          <div class="logo-title" id="siteTitle">Neuro Notes</div>
          <div class="logo-sub" id="siteTagline">Experiments • Essays • Blog</div>
        </div>
      </a>

      <nav class="nav-links">
        <a class="tab" data-route="experiments" href="#experiments">Experiments</a>
        <a class="tab" data-route="blog" href="#blog">Blog</a>
        <a class="tab" data-route="essays" href="#essays">Essays</a>
        <a class="tab" data-route="about" href="#about">About</a>
        <button id="exportBtn" class="btn">Export</button>
        <label class="btn" style="cursor:pointer;">
          Import<input id="importInput" type="file" accept="application/json" style="display:none" />
        </label>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Experiments -->
    <section id="page-experiments">
      <div class="card">
        <div class="toolbar" style="justify-content: space-between; margin-bottom: 12px;">
          <div style="font-weight:600;">Add / Edit Experiment</div>
          <div class="hint">Use Markdown + LaTeX ($...$, $$...$$). Click “Insert Image” to embed a local image.</div>
        </div>

        <div class="field">
          <label class="label">Title</label>
          <input id="exp-title" class="input" placeholder="e.g., Alpha band oscillations under working memory load" />
        </div>
        <div class="field">
          <label class="label">Status</label>
          <select id="exp-status" class="select">
            <option>Planning</option>
            <option>Running</option>
            <option>Completed</option>
          </select>
        </div>
        <div class="field">
          <label class="label">Tags (comma separated)</label>
          <input id="exp-tags" class="input" placeholder="EEG, working memory, alpha" />
        </div>
        <div class="field">
          <label class="label">Body (Markdown + LaTeX)</label>
          <textarea id="exp-body" class="textarea" placeholder="Methods, stimuli, analysis plan... Use $$\\LaTeX$$ for equations."></textarea>
          <div class="toolbar" style="margin-top:8px;">
            <button class="btn" data-insert-image="exp-body">Insert Image</button>
            <button class="btn" id="exp-save">Save</button>
            <button class="btn" id="exp-cancel">Cancel</button>
          </div>
        </div>
      </div>

      <h3 style="margin: 18px 0 8px;">Your Experiments</h3>
      <div class="field">
        <input id="exp-search" class="input" placeholder="Search experiments..." />
      </div>
      <div id="exp-list" class="list"></div>
    </section>

    <!-- Blog -->
    <section id="page-blog">
      <div class="card">
        <div class="toolbar" style="justify-content: space-between; margin-bottom: 12px;">
          <div style="font-weight:600;">New Blog Post</div>
          <div class="hint">Markdown + LaTeX supported. Use images via the button.</div>
        </div>
        <div class="field">
          <label class="label">Title</label>
          <input id="blog-title" class="input" placeholder="e.g., Why spike-timing matters" />
        </div>
        <div class="field">
          <label class="label">Body</label>
          <textarea id="blog-body" class="textarea" placeholder="Write your post..."></textarea>
          <div class="toolbar" style="margin-top:8px;">
            <button class="btn" data-insert-image="blog-body">Insert Image</button>
            <button class="btn" id="blog-save">Save</button>
            <button class="btn" id="blog-cancel">Cancel</button>
          </div>
        </div>
      </div>

      <h3 style="margin: 18px 0 8px;">Posts</h3>
      <div class="field">
        <input id="blog-search" class="input" placeholder="Search blog..." />
      </div>
      <div id="blog-list" class="list"></div>
    </section>

    <!-- Essays -->
    <section id="page-essays">
      <div class="card">
        <div class="toolbar" style="justify-content: space-between; margin-bottom: 12px;">
          <div style="font-weight:600;">New Essay</div>
          <div class="hint">Great for longer, polished writing. Markdown + LaTeX.</div>
        </div>
        <div class="field">
          <label class="label">Title</label>
          <input id="essay-title" class="input" placeholder="e.g., Neural correlates of predictive coding" />
        </div>
        <div class="field">
          <label class="label">Body</label>
          <textarea id="essay-body" class="textarea" placeholder="Write your essay..."></textarea>
          <div class="toolbar" style="margin-top:8px;">
            <button class="btn" data-insert-image="essay-body">Insert Image</button>
            <button class="btn" id="essay-save">Save</button>
            <button class="btn" id="essay-cancel">Cancel</button>
          </div>
        </div>
      </div>

      <h3 style="margin: 18px 0 8px;">Essays</h3>
      <div class="field">
        <input id="essay-search" class="input" placeholder="Search essays..." />
      </div>
      <div id="essay-list" class="list"></div>
    </section>

    <!-- About -->
    <section id="page-about">
      <div class="card">
        <h3 style="margin:0 0 8px;">About</h3>
        <div class="field">
          <label class="label">Site Title</label>
          <input id="about-title" class="input" placeholder="Neuro Notes" />
        </div>
        <div class="field">
          <label class="label">Tagline</label>
          <input id="about-tagline" class="input" placeholder="Experiments • Essays • Blog" />
        </div>
        <div class="field">
          <label class="label">Bio (Markdown + LaTeX)</label>
          <textarea id="about-bio" class="textarea" placeholder="A short bio..."></textarea>
        </div>
        <div class="field">
          <label class="label">Links (comma separated label|url)</label>
          <input id="about-links" class="input" placeholder="GitHub|https://github.com/username, Lab|https://lab.example.com" />
        </div>
        <div class="toolbar">
          <button class="btn" id="about-save">Save Profile</button>
          <span class="hint">Tip: you can export everything as JSON and import later.</span>
        </div>
      </div>

      <div class="card" style="margin-top:14px;">
        <h3 style="margin:0 0 8px;">Preview</h3>
        <div id="about-preview" class="prose"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container inner">
      <div id="footer-copy">© <span id="year"></span> Neuro Notes</div>
      <div><a href="#experiments">Experiments</a> · <a href="#blog">Blog</a> · <a href="#essays">Essays</a> · <a href="#about">About</a></div>
    </div>
  </footer>

  <script>
    // ---------- Utilities ----------
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);
    const fmtDate = (ts) => new Date(ts).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
    const storage = {
      get: (k, d) => { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch { return d; } },
      set: (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} },
    };
    const md = (text) => {
      const html = marked.parse(text || '', { breaks: true });
      const safe = DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });
      const div = document.createElement('div');
      div.innerHTML = safe;
      // Render math after markdown
      if (window.renderMathInElement) {
        renderMathInElement(div, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\\\(", right: "\\\\)", display: false},
            {left: "\\\\[", right: "\\\\]", display: true}
          ],
          throwOnError: false
        });
      }
      return div;
    };
    const insertAtCursor = (textarea, text) => {
      const start = textarea.selectionStart || 0;
      const end = textarea.selectionEnd || 0;
      const before = textarea.value.slice(0, start);
      const after = textarea.value.slice(end);
      textarea.value = before + text + after;
      const pos = start + text.length;
      textarea.focus();
      textarea.selectionStart = textarea.selectionEnd = pos;
    };
    const fileToDataUrl = (file) =>
      new Promise((res, rej) => { const fr = new FileReader(); fr.onload = () => res(fr.result); fr.onerror = rej; fr.readAsDataURL(file); });

    // Global State Keys
    const K = {
      PROFILE: 'bb_profile',
      EXPS: 'bb_experiments',
      BLOG: 'bb_blog',
      ESSAYS: 'bb_essays',
    };

    // Demo content on first load
    const demoProfile = {
      title: 'Neuro Notes',
      tagline: 'Experiments • Essays • Blog',
      bio: 'Neuroscience researcher exploring oscillations, prediction, and behavior. Write math with $e^{i\\pi}+1=0$ or display mode: $$\\int a^2\\,dx$$',
      links: [{ label:'GitHub', url:'https://github.com/' }, { label:'Lab', url:'https://example.com' }],
    };
    const demoExps = [
      {
        id: uid(),
        title: 'Working memory & alpha power',
        status: 'Running',
        tags: ['EEG','alpha','WM'],
        body: 'Hypothesis: alpha power increases with memory load. Methods: 64-channel EEG, 1–40Hz bandpass. Plot frequency bands with $$P(f) = |\\mathcal{F}\\{x(t)\\}|^2$$',
        createdAt: Date.now()-1000*60*60*24*10, updatedAt: Date.now()-1000*60*60*24*3
      }
    ];
    const demoBlog = [
      { id: uid(), title: 'On spikes and timing', body: 'Why timing matters: $\\Delta w = A_+ e^{-\\Delta t/\\tau_+}$ for pre-before-post.', createdAt: Date.now()-1000*60*60*24*7, updatedAt: Date.now()-1000*60*60*24*2 }
    ];
    const demoEssays = [
      { id: uid(), title: 'Predictive coding and perception', body: 'Sketching the core idea with a tiny derivation. $$\\mathcal{L}=\\sum_t \\|x_t - \\hat{x}_t\\|^2 + \\lambda\\,\\|\\theta\\|^2$$', createdAt: Date.now()-1000*60*60*24*20, updatedAt: Date.now()-1000*60*60*24*5 }
    ];

    // Initialize defaults
    if (!storage.get(K.PROFILE)) storage.set(K.PROFILE, demoProfile);
    if (!storage.get(K.EXPS)) storage.set(K.EXPS, demoExps);
    if (!storage.get(K.BLOG)) storage.set(K.BLOG, demoBlog);
    if (!storage.get(K.ESSAYS)) storage.set(K.ESSAYS, demoEssays);

    // ---------- Router ----------
    const routes = ['experiments','blog','essays','about'];
    const show = (name) => {
      routes.forEach(r => {
        const section = $('#page-' + r);
        const tab = document.querySelector('.tab[data-route="'+r+'"]');
        if (!section || !tab) return;
        section.classList.toggle('active', r === name);
        tab.classList.toggle('active', r === name);
      });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    const currentRoute = () => {
      const h = (location.hash || '').replace('#','').toLowerCase();
      return routes.includes(h) ? h : 'experiments';
    };
    window.addEventListener('hashchange', () => show(currentRoute()));

    // ---------- Renderers ----------
    function renderExperiments() {
      const listEl = $('#exp-list');
      const q = ($('#exp-search').value || '').toLowerCase();
      const items = storage.get(K.EXPS, []).slice().sort((a,b) => b.updatedAt - a.updatedAt)
        .filter(p => !q || (p.title + ' ' + p.body + ' ' + (p.tags||[]).join(' ')).toLowerCase().includes(q));
      listEl.innerHTML = '';
      for (const it of items) {
        const wrap = document.createElement('div');
        wrap.className = 'item';
        const head = document.createElement('div');
        head.className = 'item-head';
        const left = document.createElement('div');
        const title = document.createElement('div');
        title.className = 'item-title'; title.textContent = it.title;
        const meta = document.createElement('div');
        meta.className = 'item-meta';
        meta.textContent = `${it.status} • ${fmtDate(it.updatedAt)} • ${ (it.tags||[]).join(', ') }`;
        left.append(title, meta);
        const actions = document.createElement('div');
        actions.className = 'item-actions';
        const eBtn = document.createElement('button'); eBtn.className='btn'; eBtn.textContent='Edit';
        const dBtn = document.createElement('button'); dBtn.className='btn'; dBtn.textContent='Delete';
        actions.append(eBtn, dBtn);
        head.append(left, actions);
        const body = document.createElement('div');
        body.className = 'prose';
        body.append(md(it.body));
        wrap.append(head, body);
        listEl.append(wrap);

        eBtn.onclick = () => {
          $('#exp-title').value = it.title;
          $('#exp-status').value = it.status;
          $('#exp-tags').value = (it.tags || []).join(', ');
          $('#exp-body').value = it.body;
          editing.exp = it.id;
          show('experiments');
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        dBtn.onclick = () => {
          if (!confirm('Delete this experiment?')) return;
          const arr = storage.get(K.EXPS, []).filter(x => x.id !== it.id);
          storage.set(K.EXPS, arr);
          renderExperiments();
        };
      }
    }

    function renderBlog() {
      const listEl = $('#blog-list');
      const q = ($('#blog-search').value || '').toLowerCase();
      const items = storage.get(K.BLOG, []).slice().sort((a,b) => b.updatedAt - a.updatedAt)
        .filter(p => !q || (p.title + ' ' + p.body).toLowerCase().includes(q));
      listEl.innerHTML = '';
      for (const it of items) {
        const wrap = document.createElement('div');
        wrap.className = 'item';
        const head = document.createElement('div');
        head.className = 'item-head';
        const left = document.createElement('div');
        const title = document.createElement('div'); title.className = 'item-title'; title.textContent = it.title;
        const meta = document.createElement('div'); meta.className = 'item-meta'; meta.textContent = `Updated ${fmtDate(it.updatedAt)}`;
        left.append(title, meta);
        const actions = document.createElement('div'); actions.className = 'item-actions';
        const eBtn = document.createElement('button'); eBtn.className='btn'; eBtn.textContent='Edit';
        const dBtn = document.createElement('button'); dBtn.className='btn'; dBtn.textContent='Delete';
        actions.append(eBtn, dBtn);
        head.append(left, actions);
        const body = document.createElement('div'); body.className='prose'; body.append(md(it.body));
        wrap.append(head, body); listEl.append(wrap);

        eBtn.onclick = () => { $('#blog-title').value = it.title; $('#blog-body').value = it.body; editing.blog = it.id; show('blog'); };
        dBtn.onclick = () => { if (!confirm('Delete this post?')) return;
          const arr = storage.get(K.BLOG, []).filter(x => x.id !== it.id); storage.set(K.BLOG, arr); renderBlog(); };
      }
    }

    function renderEssays() {
      const listEl = $('#essay-list');
      const q = ($('#essay-search').value || '').toLowerCase();
      const items = storage.get(K.ESSAYS, []).slice().sort((a,b) => b.updatedAt - a.updatedAt)
        .filter(p => !q || (p.title + ' ' + p.body).toLowerCase().includes(q));
      listEl.innerHTML = '';
      for (const it of items) {
        const wrap = document.createElement('div'); wrap.className = 'item';
        const head = document.createElement('div'); head.className = 'item-head';
        const left = document.createElement('div');
        const title = document.createElement('div'); title.className = 'item-title'; title.textContent = it.title;
        const meta = document.createElement('div'); meta.className = 'item-meta'; meta.textContent = `Updated ${fmtDate(it.updatedAt)}`;
        left.append(title, meta);
        const actions = document.createElement('div'); actions.className = 'item-actions';
        const eBtn = document.createElement('button'); eBtn.className='btn'; eBtn.textContent='Edit';
        const dBtn = document.createElement('button'); dBtn.className='btn'; dBtn.textContent='Delete';
        actions.append(eBtn, dBtn);
        head.append(left, actions);
        const body = document.createElement('div'); body.className='prose'; body.append(md(it.body));
        wrap.append(head, body); listEl.append(wrap);

        eBtn.onclick = () => { $('#essay-title').value = it.title; $('#essay-body').value = it.body; editing.essays = it.id; show('essays'); };
        dBtn.onclick = () => { if (!confirm('Delete this essay?')) return;
          const arr = storage.get(K.ESSAYS, []).filter(x => x.id !== it.id); storage.set(K.ESSAYS, arr); renderEssays(); };
      }
    }

    function renderAbout() {
      const p = storage.get(K.PROFILE, demoProfile);
      $('#about-title').value = p.title || '';
      $('#about-tagline').value = p.tagline || '';
      $('#about-bio').value = p.bio || '';
      $('#about-links').value = (p.links || []).map(l => `${l.label}|${l.url}`).join(', ');

      $('#siteTitle').textContent = p.title || 'Neuro Notes';
      $('#siteTagline').textContent = p.tagline || 'Experiments • Essays • Blog';
      $('#footer-copy').innerHTML = `© <span id="year"></span> ${p.title || 'Neuro Notes'}`;

      const prev = $('#about-preview'); prev.innerHTML = '';
      const frag = md(`# ${p.title || 'Neuro Notes'}\n\n_${p.tagline || ''}_\n\n${p.bio || ''}\n\n${
        (p.links||[]).map(l => `- [${l.label}](${l.url})`).join('\\n')
      }`);
      prev.append(frag);
    }

    // ---------- Editors ----------
    const editing = { exp: null, blog: null, essays: null };

    // Insert image buttons (data URL)
    document.addEventListener('click', async (e) => {
      const target = e.target.closest('[data-insert-image]');
      if (!target) return;
      const where = target.getAttribute('data-insert-image');
      const ta = document.getElementById(where);
      const input = Object.assign(document.createElement('input'), { type: 'file', accept: 'image/*' });
      input.onchange = async () => {
        const file = input.files && input.files[0];
        if (!file) return;
        const url = await fileToDataUrl(file);
        insertAtCursor(ta, `\\n\\n![image](${url})\\n\\n`);
      };
      input.click();
    });

    // Save / cancel — Experiments
    $('#exp-save').onclick = () => {
      const title = $('#exp-title').value.trim();
      const status = $('#exp-status').value;
      const tags = $('#exp-tags').value.split(',').map(s => s.trim()).filter(Boolean);
      const body = $('#exp-body').value;
      if (!title) return alert('Title required');
      const items = storage.get(K.EXPS, []);
      if (editing.exp) {
        const idx = items.findIndex(x => x.id === editing.exp);
        if (idx !== -1) items[idx] = { ...items[idx], title, status, tags, body, updatedAt: Date.now() };
      } else {
        items.push({ id: uid(), title, status, tags, body, createdAt: Date.now(), updatedAt: Date.now() });
      }
      storage.set(K.EXPS, items);
      editing.exp = null;
      $('#exp-title').value = ''; $('#exp-tags').value = ''; $('#exp-body').value = '';
      renderExperiments();
    };
    $('#exp-cancel').onclick = () => { editing.exp = null; $('#exp-title').value=''; $('#exp-tags').value=''; $('#exp-body').value=''; };

    // Save / cancel — Blog
    $('#blog-save').onclick = () => {
      const title = $('#blog-title').value.trim();
      const body = $('#blog-body').value;
      if (!title) return alert('Title required');
      const items = storage.get(K.BLOG, []);
      if (editing.blog) {
        const idx = items.findIndex(x => x.id === editing.blog);
        if (idx !== -1) items[idx] = { ...items[idx], title, body, updatedAt: Date.now() };
      } else {
        items.push({ id: uid(), title, body, createdAt: Date.now(), updatedAt: Date.now() });
      }
      storage.set(K.BLOG, items);
      editing.blog = null;
      $('#blog-title').value=''; $('#blog-body').value='';
      renderBlog();
    };
    $('#blog-cancel').onclick = () => { editing.blog = null; $('#blog-title').value=''; $('#blog-body').value=''; };

    // Save / cancel — Essays
    $('#essay-save').onclick = () => {
      const title = $('#essay-title').value.trim();
      const body = $('#essay-body').value;
      if (!title) return alert('Title required');
      const items = storage.get(K.ESSAYS, []);
      if (editing.essays) {
        const idx = items.findIndex(x => x.id === editing.essays);
        if (idx !== -1) items[idx] = { ...items[idx], title, body, updatedAt: Date.now() };
      } else {
        items.push({ id: uid(), title, body, createdAt: Date.now(), updatedAt: Date.now() });
      }
      storage.set(K.ESSAYS, items);
      editing.essays = null;
      $('#essay-title').value=''; $('#essay-body').value='';
      renderEssays();
    };
    $('#essay-cancel').onclick = () => { editing.essays = null; $('#essay-title').value=''; $('#essay-body').value=''; };

    // Search listeners
    $('#exp-search').addEventListener('input', renderExperiments);
    $('#blog-search').addEventListener('input', renderBlog);
    $('#essay-search').addEventListener('input', renderEssays);

    // About save
    $('#about-save').onclick = () => {
      const title = $('#about-title').value.trim() || 'Neuro Notes';
      const tagline = $('#about-tagline').value.trim();
      const bio = $('#about-bio').value;
      const links = $('#about-links').value.split(',').map(s => s.trim()).filter(Boolean).map(pair => {
        const [label, url] = pair.split('|'); return { label: (label||'Link').trim(), url: (url||'').trim() };
      });
      storage.set(K.PROFILE, { title, tagline, bio, links });
      renderAbout();
    };

    // Export / Import
    $('#exportBtn').onclick = () => {
      const data = {
        profile: storage.get(K.PROFILE, {}),
        experiments: storage.get(K.EXPS, []),
        blog: storage.get(K.BLOG, []),
        essays: storage.get(K.ESSAYS, []),
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `neuro-site-backup-${new Date().toISOString().slice(0,10)}.json`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    };
    $('#importInput').onchange = async (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const text = await file.text();
      try {
        const data = JSON.parse(text);
        if (data.profile) storage.set(K.PROFILE, data.profile);
        if (data.experiments) storage.set(K.EXPS, data.experiments);
        if (data.blog) storage.set(K.BLOG, data.blog);
        if (data.essays) storage.set(K.ESSAYS, data.essays);
        renderAll();
      } catch (err) {
        alert('Invalid JSON backup.');
      } finally {
        e.target.value = '';
      }
    };

    // Initial render
    function renderAll() {
      renderAbout();
      renderExperiments();
      renderBlog();
      renderEssays();
      const y = new Date().getFullYear();
      $('#year').textContent = y;
      show(currentRoute());
    }
    renderAll();
  </script>
</body>
</html>
"""
with open('/mnt/data/neuro_blackboard_site.html', 'w', encoding='utf-8') as f:
    f.write(html)
html[:3500]

