# Update: add a Home page as the main hub with Recent Work + About snippet.
html = r"""<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>dylan standen blog — blackboard</title>

  <!-- KaTeX (LaTeX math) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js"></script>

  <!-- Markdown + Sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

  <style>
    :root {
      --bg: #0a0a0a;
      --bg2: #101010;
      --fg: #f1f1f1;
      --muted: #c9c9c9;
      --line: #2a2a2a;
      --accent: #ffffff;
      --card: #0e0e0e;
      --chip: #141414;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; background: var(--bg); color: var(--fg); font-family: var(--sans); line-height: 1.6; }
    /* Blackboard vibe */
    body::before {
      content: ""; position: fixed; inset: 0; pointer-events: none;
      background:
        radial-gradient(ellipse at top left, rgba(255,255,255,0.035), transparent 45%),
        radial-gradient(ellipse at bottom right, rgba(255,255,255,0.025), transparent 45%);
      mix-blend-mode: screen; opacity: .7;
    }
    a { color: var(--fg); }
    a:hover { text-decoration: underline; }

    .container { max-width: 1100px; margin: 0 auto; padding: 0 16px; }

    header { position: sticky; top: 0; z-index: 10; background: linear-gradient(to bottom, rgba(0,0,0,.95), rgba(0,0,0,.85)); border-bottom: 1px dashed var(--line); backdrop-filter: blur(4px); }
    .nav { display: flex; align-items: center; gap: 12px; padding: 12px 0; }
    .logo { display: inline-flex; align-items: center; gap: 10px; text-decoration: none; }
    .logo svg { display: block; }
    .logo-title { font-weight: 700; letter-spacing: .3px; text-transform: lowercase; }
    .logo-sub { font-size: 12px; color: var(--muted); line-height: 1; margin-top: -4px; }

    .nav-links { margin-left: auto; display: flex; gap: 6px; flex-wrap: wrap; }
    .tab {
      padding: 8px 12px; border: 1px dashed var(--line); border-radius: 10px;
      background: var(--chip); color: var(--fg); text-decoration: none; font-size: 14px;
    }
    .tab.active, .tab:hover { outline: 2px solid #fff; outline-offset: -2px; }

    .toolbar { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .btn { background: var(--chip); color: var(--fg); border: 1px dashed var(--line); border-radius: 10px; padding: 8px 12px; cursor: pointer; font-size: 14px; }
    .btn:hover { outline: 2px solid #fff; outline-offset: -2px; }

    .input, .select, .textarea { width: 100%; background: var(--bg2); color: var(--fg); border: 1px dashed var(--line); border-radius: 10px; padding: 10px 12px; font-size: 14px; outline: none; }
    .textarea { min-height: 180px; font-family: var(--mono); white-space: pre-wrap; }
    .field { margin-bottom: 12px; }
    .label { display: block; color: var(--muted); font-size: 12px; margin-bottom: 6px; }

    .card { background: var(--card); border: 1px dashed var(--line); border-radius: 14px; padding: 16px; }
    .list { display: grid; gap: 10px; }
    .item { padding: 14px; border-radius: 12px; border: 1px dashed var(--line); background: #0d0d0d; }
    .item-head { display: flex; align-items: baseline; gap: 8px; justify-content: space-between; }
    .item-title { font-weight: 600; font-size: 18px; }
    .item-meta { color: var(--muted); font-size: 12px; }
    .item-actions { display: flex; gap: 6px; }

    .prose { font-size: 16px; }
    .prose h1, .prose h2, .prose h3 { margin: 18px 0 8px; }
    .prose img { max-width: 100%; border: 1px dashed var(--line); border-radius: 10px; padding: 4px; background: #090909; }
    .prose code { background: #111; padding: 2px 6px; border-radius: 6px; border: 1px dashed var(--line); }
    .prose pre { background: #111; padding: 12px; border-radius: 10px; border: 1px dashed var(--line); overflow: auto; }
    .hint { color: var(--muted); font-size: 13px; }

    footer { border-top: 1px dashed var(--line); margin-top: 40px; color: var(--muted); }
    footer .inner { padding: 16px 0; display: flex; justify-content: space-between; align-items: center; }

    main > section { display: none; padding: 18px 0 24px; }
    main > section.active { display: block; }

    .grid { display: grid; gap: 10px; }
    @media (min-width: 700px) { .grid.cols-3 { grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 700px) { .grid.cols-2 { grid-template-columns: repeat(2, 1fr); } }

    .chip {
      display: inline-block; padding: 2px 8px; border: 1px dashed var(--line);
      border-radius: 999px; background: var(--chip); font-size: 12px; color: var(--muted);
    }

    @media (max-width: 640px) { .nav-links { width: 100%; margin: 8px 0 0; } }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a href="#home" class="logo" aria-label="Home">
        <!-- Logo: two orbiting bodies with fading trails (top-down celestial plane) -->
        <svg width="44" height="44" viewBox="0 0 64 64" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="32" cy="32" r="1.6" fill="white"/>
          <ellipse cx="32" cy="32" rx="26" ry="18" opacity="0.55"/>
          <ellipse cx="32" cy="32" rx="14" ry="10" opacity="0.55"/>
          <g>
            <path d="M 10 32 Q 14 16 32 14" opacity="0.20"/>
            <path d="M 12 32 Q 16 17 32 15" opacity="0.35"/>
            <path d="M 14 32 Q 18 18 32 16" opacity="0.55"/>
            <circle cx="34" cy="16" r="2.6" fill="white"/>
          </g>
          <g>
            <path d="M 54 32 Q 48 46 32 50" opacity="0.20"/>
            <path d="M 52 32 Q 47 45 32 49" opacity="0.35"/>
            <path d="M 50 32 Q 46 44 32 48" opacity="0.55"/>
            <circle cx="30" cy="48" r="1.8" fill="white"/>
          </g>
        </svg>
        <div>
          <div class="logo-title" id="siteTitle">dylan standen blog</div>
          <div class="logo-sub" id="siteTagline">projects • essays • blog</div>
        </div>
      </a>

      <nav class="nav-links">
        <a class="tab" data-route="home" href="#home">Home</a>
        <a class="tab" data-route="projects" href="#projects">Projects</a>
        <a class="tab" data-route="blog" href="#blog">Blog</a>
        <a class="tab" data-route="essays" href="#essays">Essays</a>
        <a class="tab" data-route="about" href="#about">About</a>
        <button id="exportBtn" class="btn">Export</button>
        <label class="btn" style="cursor:pointer;">
          Import<input id="importInput" type="file" accept="application/json" style="display:none" />
        </label>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- HOME -->
    <section id="page-home">
      <div class="card" style="margin-bottom:14px;">
        <div class="prose" id="home-hero"></div>
      </div>

      <div class="grid cols-3" id="home-recent"></div>

      <div class="card" style="margin-top:14px;">
        <div class="toolbar" style="justify-content: space-between;">
          <strong>Quick links</strong>
          <div>
            <a class="btn" href="#projects">All Projects</a>
            <a class="btn" href="#blog">All Posts</a>
            <a class="btn" href="#essays">All Essays</a>
            <a class="btn" href="#about">About</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Projects -->
    <section id="page-projects">
      <div class="card">
        <div class="toolbar" style="justify-content: space-between; margin-bottom: 12px;">
          <div style="font-weight:600;">Add / Edit Project</div>
          <div class="hint">Use Markdown + LaTeX ($...$, $$...$$). “Insert Image” embeds local images as data URLs.</div>
        </div>

        <div class="field">
          <label class="label">Title</label>
          <input id="proj-title" class="input" placeholder="e.g., Visualizing coupled oscillators" />
        </div>
        <div class="field">
          <label class="label">Tags (comma separated)</label>
          <input id="proj-tags" class="input" placeholder="physics, simulation, viz" />
        </div>
        <div class="field">
          <label class="label">Project URL (optional)</label>
          <input id="proj-url" class="input" placeholder="https://github.com/username/repo or live demo" />
        </div>
        <div class="field">
          <label class="label">PDF URL (optional)</label>
          <input id="proj-pdf" class="input" placeholder="https://.../paper.pdf" />
        </div>
        <div class="field">
          <label class="label">Body (Markdown + LaTeX)</label>
          <textarea id="proj-body" class="textarea" placeholder="Short description, methods, screenshots..."></textarea>
          <div class="toolbar" style="margin-top:8px;">
            <button class="btn" data-insert-image="proj-body">Insert Image</button>
            <button class="btn" id="proj-save">Save</button>
            <button class="btn" id="proj-cancel">Cancel</button>
          </div>
        </div>
      </div>

      <h3 style="margin: 18px 0 8px;">Your Projects</h3>
      <div class="field">
        <input id="proj-search" class="input" placeholder="Search projects..." />
      </div>
      <div id="proj-list" class="list"></div>
    </section>

    <!-- Blog -->
    <section id="page-blog">
      <div class="card">
        <div class="toolbar" style="justify-content: space-between; margin-bottom: 12px;">
          <div style="font-weight:600;">New Blog Post</div>
          <div class="hint">Markdown + LaTeX supported. Use images via the button.</div>
        </div>
        <div class="field">
          <label class="label">Title</label>
          <input id="blog-title" class="input" placeholder="e.g., Why orbital resonances are cool" />
        </div>
        <div class="field">
          <label class="label">Body</label>
          <textarea id="blog-body" class="textarea" placeholder="Write your post..."></textarea>
          <div class="toolbar" style="margin-top:8px;">
            <button class="btn" data-insert-image="blog-body">Insert Image</button>
            <button class="btn" id="blog-save">Save</button>
            <button class="btn" id="blog-cancel">Cancel</button>
          </div>
        </div>
      </div>

      <h3 style="margin: 18px 0 8px;">Posts</h3>
      <div class="field">
        <input id="blog-search" class="input" placeholder="Search blog..." />
      </div>
      <div id="blog-list" class="list"></div>
    </section>

    <!-- Essays -->
    <section id="page-essays">
      <div class="card">
        <div class="toolbar" style="justify-content: space-between; margin-bottom: 12px;">
          <div style="font-weight:600;">New Essay</div>
          <div class="hint">For longer, polished writing. Markdown + LaTeX.</div>
        </div>
        <div class="field">
          <label class="label">Title</label>
          <input id="essay-title" class="input" placeholder="e.g., Symplectic integrators in plain English" />
        </div>
        <div class="field">
          <label class="label">Body</label>
          <textarea id="essay-body" class="textarea" placeholder="Write your essay..."></textarea>
          <div class="toolbar" style="margin-top:8px;">
            <button class="btn" data-insert-image="essay-body">Insert Image</button>
            <button class="btn" id="essay-save">Save</button>
            <button class="btn" id="essay-cancel">Cancel</button>
          </div>
        </div>
      </div>

      <h3 style="margin: 18px 0 8px;">Essays</h3>
      <div class="field">
        <input id="essay-search" class="input" placeholder="Search essays..." />
      </div>
      <div id="essay-list" class="list"></div>
    </section>

    <!-- About -->
    <section id="page-about">
      <div class="card">
        <h3 style="margin:0 0 8px;">About</h3>
        <div class="field">
          <label class="label">Site Title</label>
          <input id="about-title" class="input" placeholder="dylan standen blog" />
        </div>
        <div class="field">
          <label class="label">Tagline</label>
          <input id="about-tagline" class="input" placeholder="projects • essays • blog" />
        </div>
        <div class="field">
          <label class="label">Bio (Markdown + LaTeX)</label>
          <textarea id="about-bio" class="textarea" placeholder="Short bio..."></textarea>
        </div>
        <div class="field">
          <label class="label">Links (comma separated label|url)</label>
          <input id="about-links" class="input" placeholder="GitHub|https://github.com/username, Website|https://example.com" />
        </div>
        <div class="toolbar">
          <button class="btn" id="about-save">Save Profile</button>
          <span class="hint">Tip: export everything as JSON and import later.</span>
        </div>
      </div>

      <div class="card" style="margin-top:14px;">
        <h3 style="margin:0 0 8px;">Preview</h3>
        <div id="about-preview" class="prose"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container inner">
      <div id="footer-copy">© <span id="year"></span> dylan standen blog</div>
      <div><a href="#home">Home</a> · <a href="#projects">Projects</a> · <a href="#blog">Blog</a> · <a href="#essays">Essays</a> · <a href="#about">About</a></div>
    </div>
  </footer>

  <script>
    // ---------- Utilities ----------
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);
    const fmtDate = (ts) => new Date(ts).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
    const storage = {
      get: (k, d) => { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch { return d; } },
      set: (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} },
    };
    const md = (text) => {
      const html = marked.parse(text || '', { breaks: true });
      const safe = DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });
      const div = document.createElement('div');
      div.innerHTML = safe;
      if (window.renderMathInElement) {
        renderMathInElement(div, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\\\(", right: "\\\\)", display: false},
            {left: "\\\\[", right: "\\\\]", display: true}
          ],
          throwOnError: false
        });
      }
      return div;
    };
    const stripToText = (htmlEl) => htmlEl.textContent || htmlEl.innerText || "";
    const excerpt = (markdown, n=160) => {
      const frag = md(markdown || "");
      const text = stripToText(frag).replace(/\\s+/g,' ').trim();
      return text.length > n ? text.slice(0, n-1) + '…' : text;
    };
    const insertAtCursor = (textarea, text) => {
      const start = textarea.selectionStart || 0;
      const end = textarea.selectionEnd || 0;
      const before = textarea.value.slice(0, start);
      const after = textarea.value.slice(end);
      textarea.value = before + text + after;
      const pos = start + text.length;
      textarea.focus();
      textarea.selectionStart = textarea.selectionEnd = pos;
    };
    const fileToDataUrl = (file) =>
      new Promise((res, rej) => { const fr = new FileReader(); fr.onload = () => res(fr.result); fr.onerror = rej; fr.readAsDataURL(file); });

    // ---------- Keys & Demo ----------
    const K = {
      PROFILE: 'bb_profile_v3',
      PROJ: 'bb_projects_v3',
      BLOG: 'bb_blog_v3',
      ESSAYS: 'bb_essays_v3',
    };

    const demoProfile = {
      title: 'dylan standen blog',
      tagline: 'projects • essays • blog',
      bio: 'Writing about physics & math. Try inline math like $e^{i\\pi}+1=0$ or display mode $$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$',
      links: [{ label:'GitHub', url:'https://github.com/' }],
    };
    const demoProjects = [
      {
        id: uid(),
        title: 'Coupled orbit demo',
        tags: ['physics','simulation'],
        url: 'https://example.com',
        pdf: '',
        body: 'Two-body motion and conserved quantities. Energy: $$E=\\frac{1}{2}\\mu v^2 - \\frac{G M \\mu}{r}$$',
        createdAt: Date.now()-1000*60*60*24*10, updatedAt: Date.now()-1000*60*60*24*3
      }
    ];
    const demoBlog = [
      { id: uid(), title: 'Resonances & ratios', body: 'Mean motion resonance 3:2 shows up with neat timing diagrams.', createdAt: Date.now()-1000*60*60*24*7, updatedAt: Date.now()-1000*60*60*24*2 }
    ];
    const demoEssays = [
      { id: uid(), title: 'An intuitive tour of Hamiltonian mechanics', body: 'Symplectic areas and why leapfrog works.', createdAt: Date.now()-1000*60*60*24*20, updatedAt: Date.now()-1000*60*60*24*5 }
    ];

    if (!storage.get(K.PROFILE)) storage.set(K.PROFILE, demoProfile);
    if (!storage.get(K.PROJ)) storage.set(K.PROJ, demoProjects);
    if (!storage.get(K.BLOG)) storage.set(K.BLOG, demoBlog);
    if (!storage.get(K.ESSAYS)) storage.set(K.ESSAYS, demoEssays);

    // ---------- Router ----------
    const routes = ['home','projects','blog','essays','about'];
    const show = (name) => {
      routes.forEach(r => {
        const section = $('#page-' + r);
        const tab = document.querySelector('.tab[data-route="'+r+'"]');
        if (!section || !tab) return;
        section.classList.toggle('active', r === name);
        tab.classList.toggle('active', r === name);
      });
      // update document title
      const p = storage.get(K.PROFILE, demoProfile);
      document.title = `${p.title || 'dylan standen blog'} — ${name}`;
      window.scrollTo({ top: 0, behavior: 'smooth' });
      if (name === 'home') renderHome();
    };
    const currentRoute = () => {
      const h = (location.hash || '').replace('#','').toLowerCase();
      return routes.includes(h) ? h : 'home';
    };
    window.addEventListener('hashchange', () => show(currentRoute()));

    // ---------- Renderers ----------
    function renderProjects() {
      const listEl = $('#proj-list');
      const q = ($('#proj-search').value || '').toLowerCase();
      const items = storage.get(K.PROJ, []).slice().sort((a,b) => b.updatedAt - a.updatedAt)
        .filter(p => !q || (p.title + ' ' + p.body + ' ' + (p.tags||[]).join(' ')).toLowerCase().includes(q));
      listEl.innerHTML = '';
      for (const it of items) {
        const wrap = document.createElement('div');
        wrap.className = 'item';
        const head = document.createElement('div'); head.className = 'item-head';
        const left = document.createElement('div');
        const title = document.createElement('div'); title.className = 'item-title'; title.textContent = it.title;
        const meta = document.createElement('div'); meta.className = 'item-meta';
        meta.textContent = `${fmtDate(it.updatedAt)} • ${ (it.tags||[]).join(', ') }`;
        left.append(title, meta);
        const actions = document.createElement('div'); actions.className = 'item-actions';
        const linkBtns = document.createElement('div');
        if (it.url) {
          const a = document.createElement('a');
          a.href = it.url; a.target = '_blank'; a.rel = 'noreferrer'; a.className = 'btn'; a.textContent = 'Project';
          linkBtns.append(a);
        }
        if (it.pdf) {
          const a = document.createElement('a');
          a.href = it.pdf; a.target = '_blank'; a.rel = 'noreferrer'; a.className = 'btn'; a.textContent = 'PDF';
          linkBtns.append(a);
        }
        const eBtn = document.createElement('button'); eBtn.className='btn'; eBtn.textContent='Edit';
        const dBtn = document.createElement('button'); dBtn.className='btn'; dBtn.textContent='Delete';
        actions.append(linkBtns, eBtn, dBtn);
        head.append(left, actions);
        const body = document.createElement('div'); body.className='prose'; body.append(md(it.body||''));
        wrap.append(head, body);
        listEl.append(wrap);

        eBtn.onclick = () => {
          $('#proj-title').value = it.title;
          $('#proj-tags').value = (it.tags || []).join(', ');
          $('#proj-url').value = it.url || '';
          $('#proj-pdf').value = it.pdf || '';
          $('#proj-body').value = it.body || '';
          editing.proj = it.id;
          show('projects'); window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        dBtn.onclick = () => {
          if (!confirm('Delete this project?')) return;
          const arr = storage.get(K.PROJ, []).filter(x => x.id !== it.id);
          storage.set(K.PROJ, arr);
          renderProjects();
          renderHome();
        };
      }
    }

    function renderBlog() {
      const listEl = $('#blog-list');
      const q = ($('#blog-search').value || '').toLowerCase();
      const items = storage.get(K.BLOG, []).slice().sort((a,b) => b.updatedAt - a.updatedAt)
        .filter(p => !q || (p.title + ' ' + p.body).toLowerCase().includes(q));
      listEl.innerHTML = '';
      for (const it of items) {
        const wrap = document.createElement('div'); wrap.className = 'item';
        const head = document.createElement('div'); head.className = 'item-head';
        const left = document.createElement('div');
        const title = document.createElement('div'); title.className = 'item-title'; title.textContent = it.title;
        const meta = document.createElement('div'); meta.className = 'item-meta'; meta.textContent = `Updated ${fmtDate(it.updatedAt)}`;
        left.append(title, meta);
        const actions = document.createElement('div'); actions.className = 'item-actions';
        const eBtn = document.createElement('button'); eBtn.className='btn'; eBtn.textContent='Edit';
        const dBtn = document.createElement('button'); dBtn.className='btn'; dBtn.textContent='Delete';
        actions.append(eBtn, dBtn);
        head.append(left, actions);
        const body = document.createElement('div'); body.className='prose'; body.append(md(it.body||''));
        wrap.append(head, body); listEl.append(wrap);
        eBtn.onclick = () => { $('#blog-title').value = it.title; $('#blog-body').value = it.body||''; editing.blog = it.id; show('blog'); };
        dBtn.onclick = () => { if (!confirm('Delete this post?')) return;
          const arr = storage.get(K.BLOG, []).filter(x => x.id !== it.id); storage.set(K.BLOG, arr); renderBlog(); renderHome(); };
      }
    }

    function renderEssays() {
      const listEl = $('#essay-list');
      const q = ($('#essay-search').value || '').toLowerCase();
      const items = storage.get(K.ESSAYS, []).slice().sort((a,b) => b.updatedAt - a.updatedAt)
        .filter(p => !q || (p.title + ' ' + p.body).toLowerCase().includes(q));
      listEl.innerHTML = '';
      for (const it of items) {
        const wrap = document.createElement('div'); wrap.className = 'item';
        const head = document.createElement('div'); head.className = 'item-head';
        const left = document.createElement('div');
        const title = document.createElement('div'); title.className = 'item-title'; title.textContent = it.title;
        const meta = document.createElement('div'); meta.className = 'item-meta'; meta.textContent = `Updated ${fmtDate(it.updatedAt)}`;
        left.append(title, meta);
        const actions = document.createElement('div'); actions.className = 'item-actions';
        const eBtn = document.createElement('button'); eBtn.className='btn'; eBtn.textContent='Edit';
        const dBtn = document.createElement('button'); dBtn.className='btn'; dBtn.textContent='Delete';
        actions.append(eBtn, dBtn);
        head.append(left, actions);
        const body = document.createElement('div'); body.className='prose'; body.append(md(it.body||''));
        wrap.append(head, body); listEl.append(wrap);
        eBtn.onclick = () => { $('#essay-title').value = it.title; $('#essay-body').value = it.body||''; editing.essays = it.id; show('essays'); };
        dBtn.onclick = () => { if (!confirm('Delete this essay?')) return;
          const arr = storage.get(K.ESSAYS, []).filter(x => x.id !== it.id); storage.set(K.ESSAYS, arr); renderEssays(); renderHome(); };
      }
    }

    function renderAbout() {
      const p = storage.get(K.PROFILE, demoProfile);
      $('#about-title').value = p.title || '';
      $('#about-tagline').value = p.tagline || '';
      $('#about-bio').value = p.bio || '';
      $('#about-links').value = (p.links || []).map(l => `${l.label}|${l.url}`).join(', ');

      $('#siteTitle').textContent = p.title || 'dylan standen blog';
      $('#siteTagline').textContent = p.tagline || 'projects • essays • blog';
      $('#footer-copy').innerHTML = `© <span id="year"></span> ${p.title || 'dylan standen blog'}`;

      const prev = $('#about-preview'); prev.innerHTML = '';
      const frag = md(`# ${p.title || 'dylan standen blog'}\n\n_${p.tagline || ''}_\n\n${p.bio || ''}\n\n${
        (p.links||[]).map(l => `- [${l.label}](${l.url})`).join('\\n')
      }`);
      prev.append(frag);
      renderHome(); // update hero/about snippet if changed
    }

    function renderHome() {
      // Hero with title, tagline, short about snippet
      const p = storage.get(K.PROFILE, demoProfile);
      const bioFrag = md(p.bio || '');
      const bioText = stripToText(bioFrag).replace(/\\s+/g,' ').trim();
      const short = bioText ? (bioText.length > 220 ? bioText.slice(0, 220) + '…' : bioText) : 'Welcome.';
      const hero = md(`# ${p.title || 'dylan standen blog'}\n\n_${p.tagline || ''}_\n\n${short}\n\n[Read more →](#about)`);
      const heroWrap = $('#home-hero'); heroWrap.innerHTML = ''; heroWrap.append(hero);

      // Recent work: unify across projects/blog/essays
      const proj = (storage.get(K.PROJ, []) || []).map(it => ({ type:'Project', updatedAt: it.updatedAt || it.createdAt || 0, title: it.title, body: it.body||'', goto:'#projects' }));
      const blog = (storage.get(K.BLOG, []) || []).map(it => ({ type:'Post',    updatedAt: it.updatedAt || it.createdAt || 0, title: it.title, body: it.body||'', goto:'#blog' }));
      const essays = (storage.get(K.ESSAYS, []) || []).map(it => ({ type:'Essay',   updatedAt: it.updatedAt || it.createdAt || 0, title: it.title, body: it.body||'', goto:'#essays' }));
      const all = [...proj, ...blog, ...essays].sort((a,b) => b.updatedAt - a.updatedAt).slice(0, 6);
      const grid = $('#home-recent'); grid.innerHTML = '';

      if (all.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'card'; empty.textContent = 'No work yet—add your first project, post, or essay!';
        grid.append(empty);
        return;
      }

      for (const it of all) {
        const card = document.createElement('div');
        card.className = 'card';
        const head = document.createElement('div');
        head.className = 'item-head';
        const left = document.createElement('div');
        const title = document.createElement('div'); title.className='item-title'; title.textContent = it.title;
        const meta = document.createElement('div'); meta.className='item-meta'; meta.textContent = `${it.type} • ${fmtDate(it.updatedAt)}`;
        left.append(title, meta);
        const btn = document.createElement('a'); btn.className='btn'; btn.textContent='Open'; btn.href = it.goto;
        head.append(left, btn);
        const body = document.createElement('div'); body.className='hint'; body.textContent = excerpt(it.body, 180);
        card.append(head, body);
        grid.append(card);
      }
    }

    // ---------- Editors ----------
    const editing = { proj: null, blog: null, essays: null };

    document.addEventListener('click', async (e) => {
      const target = e.target.closest('[data-insert-image]');
      if (!target) return;
      const where = target.getAttribute('data-insert-image');
      const ta = document.getElementById(where);
      const input = Object.assign(document.createElement('input'), { type: 'file', accept: 'image/*' });
      input.onchange = async () => {
        const file = input.files && input.files[0];
        if (!file) return;
        const url = await fileToDataUrl(file);
        insertAtCursor(ta, `\\n\\n![image](${url})\\n\\n`);
      };
      input.click();
    });

    // Save / cancel — Projects
    $('#proj-save').onclick = () => {
      const title = $('#proj-title').value.trim();
      const tags = $('#proj-tags').value.split(',').map(s => s.trim()).filter(Boolean);
      const url = $('#proj-url').value.trim();
      const pdf = $('#proj-pdf').value.trim();
      const body = $('#proj-body').value;
      if (!title) return alert('Title required');
      const items = storage.get(K.PROJ, []);
      if (editing.proj) {
        const idx = items.findIndex(x => x.id === editing.proj);
        if (idx !== -1) items[idx] = { ...items[idx], title, tags, url, pdf, body, updatedAt: Date.now() };
      } else {
        items.push({ id: uid(), title, tags, url, pdf, body, createdAt: Date.now(), updatedAt: Date.now() });
      }
      storage.set(K.PROJ, items);
      editing.proj = null;
      $('#proj-title').value = ''; $('#proj-tags').value = ''; $('#proj-url').value=''; $('#proj-pdf').value=''; $('#proj-body').value = '';
      renderProjects(); renderHome();
    };
    $('#proj-cancel').onclick = () => { editing.proj = null; $('#proj-title').value=''; $('#proj-tags').value=''; $('#proj-url').value=''; $('#proj-pdf').value=''; $('#proj-body').value=''; };

    // Save / cancel — Blog
    $('#blog-save').onclick = () => {
      const title = $('#blog-title').value.trim();
      const body = $('#blog-body').value;
      if (!title) return alert('Title required');
      const items = storage.get(K.BLOG, []);
      if (editing.blog) {
        const idx = items.findIndex(x => x.id === editing.blog);
        if (idx !== -1) items[idx] = { ...items[idx], title, body, updatedAt: Date.now() };
      } else {
        items.push({ id: uid(), title, body, createdAt: Date.now(), updatedAt: Date.now() });
      }
      storage.set(K.BLOG, items);
      editing.blog = null;
      $('#blog-title').value=''; $('#blog-body').value='';
      renderBlog(); renderHome();
    };
    $('#blog-cancel').onclick = () => { editing.blog = null; $('#blog-title').value=''; $('#blog-body').value=''; };

    // Save / cancel — Essays
    $('#essay-save').onclick = () => {
      const title = $('#essay-title').value.trim();
      const body = $('#essay-body').value;
      if (!title) return alert('Title required');
      const items = storage.get(K.ESSAYS, []);
      if (editing.essays) {
        const idx = items.findIndex(x => x.id === editing.essays);
        if (idx !== -1) items[idx] = { ...items[idx], title, body, updatedAt: Date.now() };
      } else {
        items.push({ id: uid(), title, body, createdAt: Date.now(), updatedAt: Date.now() });
      }
      storage.set(K.ESSAYS, items);
      editing.essays = null;
      $('#essay-title').value=''; $('#essay-body').value='';
      renderEssays(); renderHome();
    };
    $('#essay-cancel').onclick = () => { editing.essays = null; $('#essay-title').value=''; $('#essay-body').value=''; };

    // Search listeners
    $('#proj-search').addEventListener('input', renderProjects);
    $('#blog-search').addEventListener('input', renderBlog);
    $('#essay-search').addEventListener('input', renderEssays);

    // About save
    $('#about-save').onclick = () => {
      const title = $('#about-title').value.trim() || 'dylan standen blog';
      const tagline = $('#about-tagline').value.trim();
      const bio = $('#about-bio').value;
      const links = $('#about-links').value.split(',').map(s => s.trim()).filter(Boolean).map(pair => {
        const [label, url] = pair.split('|'); return { label: (label||'Link').trim(), url: (url||'').trim() };
      });
      storage.set(K.PROFILE, { title, tagline, bio, links });
      renderAbout();
    };

    // Export / Import
    $('#exportBtn').onclick = () => {
      const data = {
        profile: storage.get(K.PROFILE, {}),
        projects: storage.get(K.PROJ, []),
        blog: storage.get(K.BLOG, []),
        essays: storage.get(K.ESSAYS, []),
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `dylan-standen-blog-backup-${new Date().toISOString().slice(0,10)}.json`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    };
    $('#importInput').onchange = async (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const text = await file.text();
      try {
        const data = JSON.parse(text);
        if (data.profile) storage.set(K.PROFILE, data.profile);
        if (data.projects) storage.set(K.PROJ, data.projects);
        if (data.blog) storage.set(K.BLOG, data.blog);
        if (data.essays) storage.set(K.ESSAYS, data.essays);
        renderAll();
      } catch (err) {
        alert('Invalid JSON backup.');
      } finally {
        e.target.value = '';
      }
    };

    // Initial render
    function renderAll() {
      renderAbout();
      renderProjects();
      renderBlog();
      renderEssays();
      const y = new Date().getFullYear();
      $('#year').textContent = y;
      show(currentRoute());
    }
    renderAll();
  </script>
</body>
</html>
"""
with open('/mnt/data/dylan_standen_blog_home.html', 'w', encoding='utf-8') as f:
    f.write(html)
len(html)


